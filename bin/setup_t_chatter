#!/usr/bin/env ruby

require "bundler/setup"
require "t_chatter"

file_root = ENV["HOME"]
file_name = TChatter::ConfigSetup::CONFIG_FILE
file_location = "#{file_root}/#{file_name}"

unless File.exists? file_location
  puts <<-EOS
    Thanks for installing TChatter.
    A small Ruby application that allows you to chat with a your friends on a particular network

    This is the last process which basically sets up your application for you.
    Let us begin
  EOS
else
  print <<-EOS
    You seem to have this application configured already at: #{file_location}
    Do you want to overwrite your old configuration?(Y or N) :
  EOS
  exit if gets.chomp.downcase == 'n'
end

config = Hash.new(nil)

print "What is your name?(optional) : "
config[:user] = gets.chomp.strip

puts ""

print "Would you like to just send message?(optional) : "
config[:send] = gets.chomp.strip

puts ""

print "Would you like to receive messages?(optional) : "
config[:receive] = gets.chomp.strip

print "Enter your URL for the Server?(optional) : "
config[:host] = gets.chomp.strip

true_cmd = {
  'true' => true,
  'yes' => true,
  'y' => true,
  '' => true,
  'false' => false,
  'no' => false,
  'n' => false
}

real_config = Hash.new(nil)
config.each{ |x, y|
  if [:send, :receive].include? x
    real_config[x] = true_cmd[y]
  else
    real_config[x] = y if !y.blank?
  end
}

real_config[:host] = "http://tchatter.herokuapp.com" unless real_config[:host]

File.open(file_location, 'w') do |f|
  ::YAML.dump real_config, f
end

puts <<-EOS
  Congratulations you have completed the basic setup. The file can be found at: #{file_location}
EOS
